<Page
    x:Class="LiftDataManager.Views.TabellenansichtPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:SpeziControls="using:LiftDataManager.Controls"
    xmlns:controls="using:CommunityToolkit.WinUI.UI.Controls"
    xmlns:converters="using:CommunityToolkit.WinUI.UI.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:helpers="using:LiftDataManager.Helpers"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:models="using:LiftDataManager.Core.Models"
    xmlns:ui="using:CommunityToolkit.WinUI.UI"
    Style="{StaticResource PageStyle}"
    mc:Ignorable="d">

    <Page.Resources>
        <converters:BoolToObjectConverter
            x:Key="InvertBoolToObjectConverter"
            FalseValue="Visible"
            TrueValue="Collapsed" />
        <converters:BoolToObjectConverter
            x:Key="BoolToSting"
            FalseValue="False"
            TrueValue="True" />
        <helpers:EnumToStringConverter x:Key="EnumToStringConverter" />
        <Style x:Name="GridTextboxStyle" TargetType="TextBox">
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="BorderBrush" Value="Transparent" />
        </Style>
        <Style x:Name="GridComboboxStyle" TargetType="ComboBox">
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="BorderBrush" Value="Transparent" />
        </Style>
        <Style x:Name="GridCalendarDatePickerStyle" TargetType="CalendarDatePicker">
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="BorderBrush" Value="Transparent" />
        </Style>
    </Page.Resources>
    <Grid
        x:Name="ContentAreaTabelle"
        Margin="5"
        Background="{ThemeResource SystemControlPageBackgroundChromeLowBrush}"
        CornerRadius="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>
        <Grid Grid.Row="0" Margin="10,5,10,5">
            <Grid.ColumnDefinitions>
                <ColumnDefinition />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" MinWidth="250" />
            </Grid.ColumnDefinitions>
            <Button
                Grid.Column="1"
                Width="175"
                Margin="5,0,5,0"
                HorizontalAlignment="Right"
                Command="{x:Bind ViewModel.ShowAllParameters}"
                Content="All Parameters"
                FontWeight="Bold"
                Style="{StaticResource AccentButtonStyle}"
                Visibility="{x:Bind ViewModel.IsUnsavedParametersSelected, Mode=OneWay}" />
            <Button
                Grid.Column="2"
                Width="175"
                Margin="5,0,5,0"
                HorizontalAlignment="Right"
                Command="{x:Bind ViewModel.ShowUnsavedParameters}"
                Content="Unsaved Parameters"
                FontWeight="Bold"
                Style="{StaticResource AccentButtonStyle}" />
            <Button
                Grid.Column="3"
                Width="175"
                Margin="5,0,5,0"
                HorizontalAlignment="Right"
                Command="{x:Bind ViewModel.SaveAllSpeziParameters}"
                Content="Save All Parameter"
                FontWeight="Bold"
                Style="{StaticResource AccentButtonStyle}" />
            <TextBox
                Grid.Column="4"
                Margin="5"
                IsSpellCheckEnabled="False"
                PlaceholderText="Suche"
                Text="{x:Bind ViewModel.SearchInput, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
        </Grid>
        <Grid Grid.Row="1" Margin="10,5,10,5">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="auto" />
            </Grid.ColumnDefinitions>
            <Grid Margin="0,0,5,0" CornerRadius="10">
                <controls:DataGrid
                    AlternatingRowBackground="{ThemeResource SystemControlPageBackgroundListLowBrush}"
                    AutoGenerateColumns="False"
                    Background="{ThemeResource SystemChromeMediumColor}"
                    CanUserReorderColumns="True"
                    CanUserResizeColumns="True"
                    GridLinesVisibility="All"
                    ItemsSource="{x:Bind ViewModel.FilteredParameters}">
                    <controls:DataGrid.Columns>
                        <controls:DataGridTemplateColumn Header="Symbol">
                            <controls:DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <FontIcon
                                        HorizontalAlignment="Center"
                                        FontFamily="{ThemeResource SymbolThemeFontFamily}"
                                        Glyph="{Binding Symbol}" />
                                </DataTemplate>
                            </controls:DataGridTemplateColumn.CellTemplate>
                        </controls:DataGridTemplateColumn>
                        <controls:DataGridTextColumn
                            Binding="{Binding Name}"
                            Header="Parametername"
                            IsReadOnly="True" />
                        <controls:DataGridTextColumn
                            Binding="{Binding TypeCode}"
                            Header="VariablenTyp"
                            IsReadOnly="True" />
                        <controls:DataGridTemplateColumn Header="Parameterwert">
                            <controls:DataGridTemplateColumn.CellTemplate>
                                <DataTemplate x:DataType="models:Parameter">
                                    <controls:SwitchPresenter Value="{x:Bind ParameterTyp, Mode=OneWay, Converter={StaticResource EnumToStringConverter}}">
                                        <controls:Case Value="String">
                                            <TextBox
                                                HorizontalAlignment="Stretch"
                                                VerticalAlignment="Stretch"
                                                AcceptsReturn="True"
                                                Style="{StaticResource GridTextboxStyle}"
                                                Text="{x:Bind Value, Mode=TwoWay}"
                                                TextWrapping="Wrap" />
                                        </controls:Case>
                                        <controls:Case Value="NumberOnly">
                                            <TextBox
                                                HorizontalAlignment="Stretch"
                                                VerticalAlignment="Stretch"
                                                ui:TextBoxExtensions.ValidationMode="Dynamic"
                                                ui:TextBoxExtensions.ValidationType="Decimal"
                                                AcceptsReturn="True"
                                                Style="{StaticResource GridTextboxStyle}"
                                                Text="{x:Bind Value, Mode=TwoWay}"
                                                TextWrapping="Wrap" />
                                        </controls:Case>
                                        <controls:Case Value="Date">
                                            <CalendarDatePicker
                                                HorizontalAlignment="Stretch"
                                                VerticalAlignment="Stretch"
                                                CalendarIdentifier="GregorianCalendar"
                                                Date="{x:Bind Date, Mode=TwoWay}"
                                                DateFormat="{}{day.integer}/{month.integer}/{year.full}"
                                                Language="de"
                                                PlaceholderText="Datum auswählen"
                                                Style="{StaticResource GridCalendarDatePickerStyle}" />
                                        </controls:Case>
                                        <controls:Case Value="Boolean">
                                            <ComboBox
                                                HorizontalAlignment="Stretch"
                                                VerticalAlignment="Stretch"
                                                SelectedValue="{x:Bind BoolValue, Converter={StaticResource BoolToSting}, Mode=TwoWay}"
                                                Style="{StaticResource GridComboboxStyle}">
                                                <x:String>True</x:String>
                                                <x:String>False</x:String>
                                            </ComboBox>
                                        </controls:Case>
                                        <controls:Case Value="DropDownList">
                                            <ComboBox
                                                HorizontalAlignment="Stretch"
                                                VerticalAlignment="Stretch"
                                                ItemsSource="{x:Bind DropDownList, Mode=OneWay}"
                                                SelectedValue="{x:Bind DropDownListValue, Mode=TwoWay}"
                                                Style="{StaticResource GridComboboxStyle}" />
                                        </controls:Case>
                                        <controls:Case IsDefault="True">
                                            <TextBlock
                                                FontWeight="Bold"
                                                Foreground="red"
                                                Text="Kein bekannter Parametertyp gefunden." />
                                        </controls:Case>
                                    </controls:SwitchPresenter>
                                </DataTemplate>
                            </controls:DataGridTemplateColumn.CellTemplate>
                        </controls:DataGridTemplateColumn>
                        <controls:DataGridCheckBoxColumn
                            Width="45"
                            Binding="{Binding IsKey}"
                            HeaderStyle="{StaticResource SymbolHeaderKey}" />
                        <controls:DataGridTemplateColumn Header="Kommentar">
                            <controls:DataGridTemplateColumn.CellTemplate>
                                <DataTemplate x:DataType="models:Parameter">
                                    <StackPanel>
                                        <TextBox
                                            HorizontalAlignment="Stretch"
                                            AcceptsReturn="True"
                                            Style="{StaticResource GridTextboxStyle}"
                                            Text="{x:Bind Comment, Mode=TwoWay}"
                                            TextWrapping="Wrap" />
                                    </StackPanel>
                                </DataTemplate>
                            </controls:DataGridTemplateColumn.CellTemplate>
                        </controls:DataGridTemplateColumn>
                    </controls:DataGrid.Columns>
                </controls:DataGrid>
            </Grid>
            <!--  InfoSidebarPanel  -->
            <SpeziControls:SidebarPanel
                Grid.Column="1"
                Margin="0"
                InfoText="{x:Bind ViewModel.InfoSidebarPanelText, Mode=TwoWay}" />
        </Grid>
        <!--  Footer  -->
        <SpeziControls:FooterControl
            Grid.Row="2"
            Margin="0"
            CheckOut="{x:Bind ViewModel.CheckOut, Mode=OneWay}"
            ParameterFound="{x:Bind ViewModel.FilteredParameters.Count, Mode=OneWay}"
            XmlPath="{x:Bind ViewModel.FullPathXml, Mode=OneWay}" />
    </Grid>
</Page>
